var Matrix4=function(e){var t,n,r;if(e&&typeof e==="object"&&e.hasOwnProperty("elements")){n=e.elements;r=new Float32Array(16);for(t=0;t<16;++t){r[t]=n[t]}this.elements=r}else{this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}};Matrix4.prototype.setIdentity=function(){var e=this.elements;e[0]=1;e[4]=0;e[8]=0;e[12]=0;e[1]=0;e[5]=1;e[9]=0;e[13]=0;e[2]=0;e[6]=0;e[10]=1;e[14]=0;e[3]=0;e[7]=0;e[11]=0;e[15]=1;return this};Matrix4.prototype.set=function(e){var t,n,r;n=e.elements;r=this.elements;if(n===r){return}for(t=0;t<16;++t){r[t]=n[t]}return this};Matrix4.prototype.concat=function(e){var t,n,r,i,s,o,u,a;n=this.elements;r=this.elements;i=e.elements;if(n===i){i=new Float32Array(16);for(t=0;t<16;++t){i[t]=n[t]}}for(t=0;t<4;t++){s=r[t];o=r[t+4];u=r[t+8];a=r[t+12];n[t]=s*i[0]+o*i[1]+u*i[2]+a*i[3];n[t+4]=s*i[4]+o*i[5]+u*i[6]+a*i[7];n[t+8]=s*i[8]+o*i[9]+u*i[10]+a*i[11];n[t+12]=s*i[12]+o*i[13]+u*i[14]+a*i[15]}return this};Matrix4.prototype.multiply=Matrix4.prototype.concat;Matrix4.prototype.multiplyVector3=function(e){var t=this.elements;var n=e.elements;var r=new Vector3;var i=r.elements;i[0]=n[0]*t[0]+n[1]*t[4]+n[2]*t[8]+t[11];i[1]=n[0]*t[1]+n[1]*t[5]+n[2]*t[9]+t[12];i[2]=n[0]*t[2]+n[1]*t[6]+n[2]*t[10]+t[13];return r};Matrix4.prototype.multiplyVector4=function(e){var t=this.elements;var n=e.elements;var r=new Vector4;var i=r.elements;i[0]=n[0]*t[0]+n[1]*t[4]+n[2]*t[8]+n[3]*t[12];i[1]=n[0]*t[1]+n[1]*t[5]+n[2]*t[9]+n[3]*t[13];i[2]=n[0]*t[2]+n[1]*t[6]+n[2]*t[10]+n[3]*t[14];i[3]=n[0]*t[3]+n[1]*t[7]+n[2]*t[11]+n[3]*t[15];return r};Matrix4.prototype.transpose=function(){var e,t;e=this.elements;t=e[1];e[1]=e[4];e[4]=t;t=e[2];e[2]=e[8];e[8]=t;t=e[3];e[3]=e[12];e[12]=t;t=e[6];e[6]=e[9];e[9]=t;t=e[7];e[7]=e[13];e[13]=t;t=e[11];e[11]=e[14];e[14]=t;return this};Matrix4.prototype.setInverseOf=function(e){var t,n,r,i,s;n=e.elements;r=this.elements;i=new Float32Array(16);i[0]=n[5]*n[10]*n[15]-n[5]*n[11]*n[14]-n[9]*n[6]*n[15]+n[9]*n[7]*n[14]+n[13]*n[6]*n[11]-n[13]*n[7]*n[10];i[4]=-n[4]*n[10]*n[15]+n[4]*n[11]*n[14]+n[8]*n[6]*n[15]-n[8]*n[7]*n[14]-n[12]*n[6]*n[11]+n[12]*n[7]*n[10];i[8]=n[4]*n[9]*n[15]-n[4]*n[11]*n[13]-n[8]*n[5]*n[15]+n[8]*n[7]*n[13]+n[12]*n[5]*n[11]-n[12]*n[7]*n[9];i[12]=-n[4]*n[9]*n[14]+n[4]*n[10]*n[13]+n[8]*n[5]*n[14]-n[8]*n[6]*n[13]-n[12]*n[5]*n[10]+n[12]*n[6]*n[9];i[1]=-n[1]*n[10]*n[15]+n[1]*n[11]*n[14]+n[9]*n[2]*n[15]-n[9]*n[3]*n[14]-n[13]*n[2]*n[11]+n[13]*n[3]*n[10];i[5]=n[0]*n[10]*n[15]-n[0]*n[11]*n[14]-n[8]*n[2]*n[15]+n[8]*n[3]*n[14]+n[12]*n[2]*n[11]-n[12]*n[3]*n[10];i[9]=-n[0]*n[9]*n[15]+n[0]*n[11]*n[13]+n[8]*n[1]*n[15]-n[8]*n[3]*n[13]-n[12]*n[1]*n[11]+n[12]*n[3]*n[9];i[13]=n[0]*n[9]*n[14]-n[0]*n[10]*n[13]-n[8]*n[1]*n[14]+n[8]*n[2]*n[13]+n[12]*n[1]*n[10]-n[12]*n[2]*n[9];i[2]=n[1]*n[6]*n[15]-n[1]*n[7]*n[14]-n[5]*n[2]*n[15]+n[5]*n[3]*n[14]+n[13]*n[2]*n[7]-n[13]*n[3]*n[6];i[6]=-n[0]*n[6]*n[15]+n[0]*n[7]*n[14]+n[4]*n[2]*n[15]-n[4]*n[3]*n[14]-n[12]*n[2]*n[7]+n[12]*n[3]*n[6];i[10]=n[0]*n[5]*n[15]-n[0]*n[7]*n[13]-n[4]*n[1]*n[15]+n[4]*n[3]*n[13]+n[12]*n[1]*n[7]-n[12]*n[3]*n[5];i[14]=-n[0]*n[5]*n[14]+n[0]*n[6]*n[13]+n[4]*n[1]*n[14]-n[4]*n[2]*n[13]-n[12]*n[1]*n[6]+n[12]*n[2]*n[5];i[3]=-n[1]*n[6]*n[11]+n[1]*n[7]*n[10]+n[5]*n[2]*n[11]-n[5]*n[3]*n[10]-n[9]*n[2]*n[7]+n[9]*n[3]*n[6];i[7]=n[0]*n[6]*n[11]-n[0]*n[7]*n[10]-n[4]*n[2]*n[11]+n[4]*n[3]*n[10]+n[8]*n[2]*n[7]-n[8]*n[3]*n[6];i[11]=-n[0]*n[5]*n[11]+n[0]*n[7]*n[9]+n[4]*n[1]*n[11]-n[4]*n[3]*n[9]-n[8]*n[1]*n[7]+n[8]*n[3]*n[5];i[15]=n[0]*n[5]*n[10]-n[0]*n[6]*n[9]-n[4]*n[1]*n[10]+n[4]*n[2]*n[9]+n[8]*n[1]*n[6]-n[8]*n[2]*n[5];s=n[0]*i[0]+n[1]*i[4]+n[2]*i[8]+n[3]*i[12];if(s===0){return this}s=1/s;for(t=0;t<16;t++){r[t]=i[t]*s}return this};Matrix4.prototype.invert=function(){return this.setInverseOf(this)};Matrix4.prototype.setOrtho=function(e,t,n,r,i,s){var o,u,a,f;if(e===t||n===r||i===s){throw"null frustum"}u=1/(t-e);a=1/(r-n);f=1/(s-i);o=this.elements;o[0]=2*u;o[1]=0;o[2]=0;o[3]=0;o[4]=0;o[5]=2*a;o[6]=0;o[7]=0;o[8]=0;o[9]=0;o[10]=-2*f;o[11]=0;o[12]=-(t+e)*u;o[13]=-(r+n)*a;o[14]=-(s+i)*f;o[15]=1;return this};Matrix4.prototype.ortho=function(e,t,n,r,i,s){return this.concat((new Matrix4).setOrtho(e,t,n,r,i,s))};Matrix4.prototype.setFrustum=function(e,t,n,r,i,s){var o,u,a,f;if(e===t||r===n||i===s){throw"null frustum"}if(i<=0){throw"near <= 0"}if(s<=0){throw"far <= 0"}u=1/(t-e);a=1/(r-n);f=1/(s-i);o=this.elements;o[0]=2*i*u;o[1]=0;o[2]=0;o[3]=0;o[4]=0;o[5]=2*i*a;o[6]=0;o[7]=0;o[8]=(t+e)*u;o[9]=(r+n)*a;o[10]=-(s+i)*f;o[11]=-1;o[12]=0;o[13]=0;o[14]=-2*i*s*f;o[15]=0;return this};Matrix4.prototype.frustum=function(e,t,n,r,i,s){return this.concat((new Matrix4).setFrustum(e,t,n,r,i,s))};Matrix4.prototype.setPerspective=function(e,t,n,r){var i,s,o,u;if(n===r||t===0){throw"null frustum"}if(n<=0){throw"near <= 0"}if(r<=0){throw"far <= 0"}e=Math.PI*e/180/2;o=Math.sin(e);if(o===0){throw"null frustum"}s=1/(r-n);u=Math.cos(e)/o;i=this.elements;i[0]=u/t;i[1]=0;i[2]=0;i[3]=0;i[4]=0;i[5]=u;i[6]=0;i[7]=0;i[8]=0;i[9]=0;i[10]=-(r+n)*s;i[11]=-1;i[12]=0;i[13]=0;i[14]=-2*n*r*s;i[15]=0;return this};Matrix4.prototype.perspective=function(e,t,n,r){return this.concat((new Matrix4).setPerspective(e,t,n,r))};Matrix4.prototype.setScale=function(e,t,n){var r=this.elements;r[0]=e;r[4]=0;r[8]=0;r[12]=0;r[1]=0;r[5]=t;r[9]=0;r[13]=0;r[2]=0;r[6]=0;r[10]=n;r[14]=0;r[3]=0;r[7]=0;r[11]=0;r[15]=1;return this};Matrix4.prototype.scale=function(e,t,n){var r=this.elements;r[0]*=e;r[4]*=t;r[8]*=n;r[1]*=e;r[5]*=t;r[9]*=n;r[2]*=e;r[6]*=t;r[10]*=n;r[3]*=e;r[7]*=t;r[11]*=n;return this};Matrix4.prototype.setTranslate=function(e,t,n){var r=this.elements;r[0]=1;r[4]=0;r[8]=0;r[12]=e;r[1]=0;r[5]=1;r[9]=0;r[13]=t;r[2]=0;r[6]=0;r[10]=1;r[14]=n;r[3]=0;r[7]=0;r[11]=0;r[15]=1;return this};Matrix4.prototype.translate=function(e,t,n){var r=this.elements;r[12]+=r[0]*e+r[4]*t+r[8]*n;r[13]+=r[1]*e+r[5]*t+r[9]*n;r[14]+=r[2]*e+r[6]*t+r[10]*n;r[15]+=r[3]*e+r[7]*t+r[11]*n;return this};Matrix4.prototype.setRotate=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v;e=Math.PI*e/180;i=this.elements;s=Math.sin(e);o=Math.cos(e);if(0!==t&&0===n&&0===r){if(t<0){s=-s}i[0]=1;i[4]=0;i[8]=0;i[12]=0;i[1]=0;i[5]=o;i[9]=-s;i[13]=0;i[2]=0;i[6]=s;i[10]=o;i[14]=0;i[3]=0;i[7]=0;i[11]=0;i[15]=1}else if(0===t&&0!==n&&0===r){if(n<0){s=-s}i[0]=o;i[4]=0;i[8]=s;i[12]=0;i[1]=0;i[5]=1;i[9]=0;i[13]=0;i[2]=-s;i[6]=0;i[10]=o;i[14]=0;i[3]=0;i[7]=0;i[11]=0;i[15]=1}else if(0===t&&0===n&&0!==r){if(r<0){s=-s}i[0]=o;i[4]=-s;i[8]=0;i[12]=0;i[1]=s;i[5]=o;i[9]=0;i[13]=0;i[2]=0;i[6]=0;i[10]=1;i[14]=0;i[3]=0;i[7]=0;i[11]=0;i[15]=1}else{u=Math.sqrt(t*t+n*n+r*r);if(u!==1){a=1/u;t*=a;n*=a;r*=a}f=1-o;l=t*n;c=n*r;h=r*t;p=t*s;d=n*s;v=r*s;i[0]=t*t*f+o;i[1]=l*f+v;i[2]=h*f-d;i[3]=0;i[4]=l*f-v;i[5]=n*n*f+o;i[6]=c*f+p;i[7]=0;i[8]=h*f+d;i[9]=c*f-p;i[10]=r*r*f+o;i[11]=0;i[12]=0;i[13]=0;i[14]=0;i[15]=1}return this};Matrix4.prototype.rotate=function(e,t,n,r){return this.concat((new Matrix4).setRotate(e,t,n,r))};Matrix4.prototype.setLookAt=function(e,t,n,r,i,s,o,u,a){var f,l,c,h,p,d,v,m,g,y,b,w;l=r-e;c=i-t;h=s-n;p=1/Math.sqrt(l*l+c*c+h*h);l*=p;c*=p;h*=p;d=c*a-h*u;v=h*o-l*a;m=l*u-c*o;g=1/Math.sqrt(d*d+v*v+m*m);d*=g;v*=g;m*=g;y=v*h-m*c;b=m*l-d*h;w=d*c-v*l;f=this.elements;f[0]=d;f[1]=y;f[2]=-l;f[3]=0;f[4]=v;f[5]=b;f[6]=-c;f[7]=0;f[8]=m;f[9]=w;f[10]=-h;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return this.translate(-e,-t,-n)};Matrix4.prototype.lookAt=function(e,t,n,r,i,s,o,u,a){return this.concat((new Matrix4).setLookAt(e,t,n,r,i,s,o,u,a))};Matrix4.prototype.dropShadow=function(e,t){var n=new Matrix4;var r=n.elements;var i=e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3];r[0]=i-t[0]*e[0];r[1]=-t[1]*e[0];r[2]=-t[2]*e[0];r[3]=-t[3]*e[0];r[4]=-t[0]*e[1];r[5]=i-t[1]*e[1];r[6]=-t[2]*e[1];r[7]=-t[3]*e[1];r[8]=-t[0]*e[2];r[9]=-t[1]*e[2];r[10]=i-t[2]*e[2];r[11]=-t[3]*e[2];r[12]=-t[0]*e[3];r[13]=-t[1]*e[3];r[14]=-t[2]*e[3];r[15]=i-t[3]*e[3];return this.concat(n)};Matrix4.prototype.dropShadowDirectionally=function(e,t,n,r,i,s,o,u,a){var f=r*e+i*t+s*n;return this.dropShadow([e,t,n,-f],[o,u,a,0])};var Vector3=function(e){var t=new Float32Array(3);if(e&&typeof e==="object"){t[0]=e[0];t[1]=e[1];t[2]=e[2]}this.elements=t};Vector3.prototype.normalize=function(){var e=this.elements;var t=e[0],n=e[1],r=e[2],i=Math.sqrt(t*t+n*n+r*r);if(i){if(i==1)return this}else{e[0]=0;e[1]=0;e[2]=0;return this}i=1/i;e[0]=t*i;e[1]=n*i;e[2]=r*i;return this};var Vector4=function(e){var t=new Float32Array(4);if(e&&typeof e==="object"){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3]}this.elements=t}